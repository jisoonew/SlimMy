<Page x:Class="SlimMy.View.ExerciseHistory"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:SlimMy.ViewModel"
xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
      mc:Ignorable="d"
      Title="ExerciseHistory" Width="1110" Height="850" Background="White">

    <Page.DataContext>
        <local:ExerciseHistoryViewModel/>
    </Page.DataContext>

    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- íŽ˜ì´ì§€ ì œëª© -->
        <TextBlock Text="ìš´ë™ ê¸°ë¡" FontSize="28" FontWeight="Bold" Grid.Row="0" Margin="0,0,0,20"/>

        <!-- í•„í„° ë° ê²€ìƒ‰ ì˜ì—­ -->
        <StackPanel Orientation="Vertical" Grid.Row="1" Margin="0,0,0,30">
            <!-- í•˜ë‹¨: í•„í„° + ë‚´ë³´ë‚´ê¸° í˜•ì‹ ì˜µì…˜ -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <Label Content="ê¸°ê°„:" VerticalAlignment="Center"/>
                <DatePicker SelectedDate="{Binding StartDate}" Width="130"/>
                <TextBlock Text="~" VerticalAlignment="Center" Margin="5,0"/>
                <DatePicker SelectedDate="{Binding EndDate}" Width="130"/>
                <Label Content="ìš´ë™ëª…:" VerticalAlignment="Center"/>
                <TextBox Width="150" Text="{Binding SearchKeyword}"/>
                <Button Content="ê²€ìƒ‰" Width="80" Command="{Binding SearchCommand}" Margin="5,0,0,0"/>

                <!-- ë‚´ë³´ë‚´ê¸° í˜•ì‹ ì„ íƒ -->
                <ComboBox Width="100" SelectedItem="{Binding SelectedExportFormat}" Margin="10,0,0,0"
                  ItemsSource="{Binding ExportFormatOptions}" />
                <Button Content="ë‚´ë³´ë‚´ê¸°" Width="100" Margin="5,0,0,0" Click="ExportButton_Click"/>
            </StackPanel>
        </StackPanel>

        <!-- ë©”ì¸ ë‚´ìš© -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="3*"/>
            </Grid.RowDefinitions>
            
            <!-- ìƒë‹¨: í‰ê·  í†µê³„ -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                <TextBlock Text="ðŸ”¥ í‰ê·  ì¹¼ë¡œë¦¬:" FontWeight="Bold"/>
                <TextBlock Text="{Binding AverageCalories}" Margin="5,0,20,0"/>
                <TextBlock Text="â± í‰ê·  ì‹œê°„:" FontWeight="Bold"/>
                <TextBlock Text="{Binding AverageDuration}" Margin="5,0,0,0"/>
            </StackPanel>
            
            <!-- ìš´ë™ ê¸°ë¡ ë¦¬ìŠ¤íŠ¸ -->
            <DataGrid Grid.Row="1" ItemsSource="{Binding FilteredExerciseLogs}" AutoGenerateColumns="False"
                      CanUserAddRows="False" Margin="0,0,0,10" HeadersVisibility="Column" FontSize="14" Height="320">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ë‚ ì§œ" Binding="{Binding PlannerDate, StringFormat=yyyy-MM-dd}" Width="*"/>
                    <DataGridTextColumn Header="ìš´ë™ëª…" Binding="{Binding ExerciseName}" Width="*"/>
                    <DataGridTextColumn Header="ì‹œê°„(ë¶„)" Binding="{Binding Minutes}" Width="*"/>
                    <DataGridTextColumn Header="ì¹¼ë¡œë¦¬" Binding="{Binding Calories}" Width="*"/>
                    <DataGridTextColumn Header="ìš´ë™ ì¢…ë¥˜" Binding="{Binding Category}" Width="*"/>
                </DataGrid.Columns>
            </DataGrid>

            <!-- í•˜ë‹¨ ê·¸ëž˜í”„ -->
            <Grid Grid.Row="2" Height="220">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- ì¹¼ë¡œë¦¬ ì†Œëª¨ ì¶”ì„¸ -->
                <Border BorderBrush="#DDD" Grid.Column="0" Grid.Row="0" BorderThickness="1" CornerRadius="10" Padding="10" Margin="5">
                    <StackPanel>
                        <TextBlock Text="ðŸ“‰ ì¹¼ë¡œë¦¬ ì†Œëª¨ ì¶”ì„¸" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                        <lvc:CartesianChart x:Name="CalorieTrendChart" Series="{Binding CalorieTrendSeries}" Height="150">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Labels="{Binding Labels}" Title="ë‚ ì§œ"/>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis Title="ì¹¼ë¡œë¦¬(kcal)"/>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </StackPanel>
                </Border>

                <!-- ìš´ë™ ì¢…ë¥˜ë³„ ë¹„ìœ¨ -->
                <Border BorderBrush="#DDD" Grid.Column="1" Grid.Row="0" BorderThickness="1" CornerRadius="10" Padding="10" Margin="5">
                    <StackPanel>
                        <TextBlock Text="ðŸ“Š ìš´ë™ ì¢…ë¥˜ë³„ ë¹„ìœ¨" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                        <lvc:PieChart x:Name="CategoryDistributionChart" Series="{Binding CategoryDistributionSeries}" Height="150"/>
                    </StackPanel>
                </Border>

                <!-- ìš´ë™ ì‹œê°„ ì¶”ì„¸ -->
                <Border BorderBrush="#DDD" Grid.Column="2" Grid.Row="0" BorderThickness="1" CornerRadius="10" Padding="10" Margin="5">
                    <StackPanel>
                        <TextBlock Text="â± ìš´ë™ ì‹œê°„ ì¶”ì„¸" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                        <lvc:CartesianChart x:Name="DurationTrendChart" Series="{Binding DurationTrendSeries}" Height="150">
                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Labels="{Binding Labels}" Title="ë‚ ì§œ"/>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis Title="ìš´ë™ ì‹œê°„"/>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </StackPanel>
                </Border>

                <Border BorderBrush="#DDD" Grid.Row="1" BorderThickness="1" CornerRadius="10" Padding="10" Margin="5">
                    <StackPanel>
                        <TextBlock Text="â± ìš´ë™ ì‹œê°„ ì¶”ì„¸" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Page>
